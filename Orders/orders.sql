CREATE DATABASE order1;
use order1;
CREATE TABLE SALESMAN
(
    SALESMANID NUMERIC,
    NAME VARCHAR(20),
    CITY VARCHAR(20),
    COMMISSION VARCHAR(20),
    PRIMARY KEY (SALESMANID)
);
DESC SALESMAN;

CREATE TABLE CUSTOMER
(
    CUSTOMERID NUMERIC,
    CUSTNAME VARCHAR(20),
    CITY VARCHAR(20),
    GRADE NUMERIC,
    PRIMARY KEY (CUSTOMERID),
    SALESMANID NUMERIC,
    FOREIGN KEY (SALESMANID) REFERENCES SALESMAN(SALESMANID) ON DELETE SET NULL
);
DESC CUSTOMER;

CREATE TABLE ORDERS
(
    ORDNO NUMERIC,
    PURCHASEAMT NUMERIC,
    ORDDATE DATE,
    PRIMARY KEY(ORDNO),
    CUSTOMERID NUMERIC,
    FOREIGN KEY (CUSTOMERID) REFERENCES CUSTOMER(CUSTOMERID) ON DELETE CASCADE,
    SALESMANID NUMERIC, FOREIGN KEY (SALESMANID) REFERENCES SALESMAN(SALESMANID) ON DELETE SET NULL
);
DESC ORDERS;

# Insertion
INSERT INTO SALESMAN VALUES(1000,'JOHN','BANGALORE','25%');
INSERT INTO SALESMAN VALUES(2000,'RAVI','BANGALORE','20%');
INSERT INTO SALESMAN VALUES(3000,'KUMAR','MYSORE','15%');
INSERT INTO SALESMAN VALUES(4000,'SMITH','DELHI','30%');
INSERT INTO SALESMAN VALUES(5000,'HARSHA','HYDERABAD','15%');
SELECT * FROM SALESMAN;

INSERT INTO CUSTOMER VALUES(10,'PREETHI','BANGALORE',100,1000);
INSERT INTO CUSTOMER VALUES(11,'VIVEK','MANGALORE',300,1000);
INSERT INTO CUSTOMER VALUES(12,'BHASKAR','CHENNAI',400,2000);
INSERT INTO CUSTOMER VALUES(13,'CHETTAN','BANGALORE',200,2000);
INSERT INTO CUSTOMER VALUES(14,'MANISH','BANGALORE',400,3000);
SELECT * FROM CUSTOMER;

INSERT INTO ORDERS VALUES(50,5000,'2017-05-04',10,1000);
INSERT INTO ORDERS VALUES(51,450,'2017-01-20',10,2000);
INSERT INTO ORDERS VALUES(52,1000,'2017-02-24',13,2000);
INSERT INTO ORDERS VALUES(53,3500,'2017-04-13',14,3000);
INSERT INTO ORDERS VALUES(54,550,'2017-03-09',12,2000);
SELECT * FROM ORDERS;

# Queries

# Count the customers with grades above Bangalore’s average.
SELECT GRADE,COUNT(DISTINCT CUSTOMERID)
FROM CUSTOMER
GROUP BY GRADE HAVING GRADE > ( SELECT AVG(GRADE) FROM CUSTOMER WHERE CITY='BANGALORE' );

# Find the name and numbers of all salesmen who had more than one customer.
SELECT SALESMANID, NAME
FROM SALESMAN A
WHERE 1 < (SELECT COUNT(*)
FROM CUSTOMER WHERE SALESMANID=A.SALESMANID);

# List all salesmen and indicate those who have and don’t have customers in their cities (Use UNION operation.)
SELECT SALESMAN.SALESMANID, NAME,CUSTNAME,COMMISSION
FROM SALESMAN,CUSTOMER
WHERE SALESMAN.CITY=CUSTOMER.CITY
UNION
SELECT SALESMANID,NAME,'NO MATCH',COMMISSION
FROM SALESMAN
WHERE NOT CITY= ANY (SELECT CITY FROM CUSTOMER) ORDER BY 2 DESC;

# Create a view that finds the salesman who has the customer with the highest order of a day.
CREATE VIEW ELITSALESMAN
AS SELECT B.ORDDATE,A.SALESMANID,A.NAME
FROM SALESMAN A,ORDERS B
WHERE A.SALESMANID=B.SALESMANID
AND
B.PURCHASEAMT= (SELECT MAX(PURCHASEAMT) FROM ORDERS C WHERE C.ORDDATE=B.ORDDATE) ;

SELECT * FROM ELITSALESMAN;

# Demonstrate the DELETE operation by removing salesman with id 1000. All his orders must also be deleted.
DELETE FROM SALESMAN
WHERE SALESMANID=1000;

SELECT * FROM SALESMAN;